generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Article {
  id               String             @id @default(cuid())
  title            String
  link             String             @unique
  imageUrl         String?
  source           String?
  description      String?
  publishedAt      DateTime
  scrapedAt        DateTime           @default(now())
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  content          String?
  localImage       String?
  r2Url            String?
  hidden           Boolean            @default(false)
  ArticleGoogleTag ArticleGoogleTag[]

  @@index([publishedAt])
  @@index([source])
  @@index([hidden])
}

model ScrapingLog {
  id            String    @id @default(cuid())
  startedAt     DateTime  @default(now())
  finishedAt    DateTime?
  status        String
  isConnected   Boolean   @default(false)
  articlesCount Int       @default(0)
  successCount  Int       @default(0)
  errorCount    Int       @default(0)
  details       Json?
  errorMessage  String?
}

model AppConfig {
  key       String   @id
  value     String
  updatedAt DateTime @updatedAt
}

model WeatherHistory {
  id          String   @id @default(cuid())
  location    String
  day         Int
  month       Int
  year        Int
  tempMax     Float
  tempMin     Float
  weatherCode Int
  createdAt   DateTime @default(now())

  @@unique([location, day, month, year])
  @@index([location])
  @@index([day, month])
}

model ArticleGoogleTag {
  articleId String
  tagId     String
  Article   Article @relation(fields: [articleId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  NewsTag   NewsTag @relation(fields: [tagId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([articleId, tagId])
  @@index([articleId])
  @@index([tagId])
}

model NewsArticle {
  id             String           @id @default(dbgenerated("(gen_random_uuid())::text"))
  associationId  String
  authorId       String
  title          String
  slug           String
  content        String
  excerpt        String?
  featuredImage  String?
  status         String           @default("DRAFT")
  statusWorkflow String           @default("DRAFT")
  publishedAt    DateTime?
  hidden         Boolean          @default(false)
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @default(now())
  NewsArticleTag NewsArticleTag[]

  @@unique([associationId, slug])
  @@index([associationId])
  @@index([hidden])
  @@index([publishedAt])
  @@index([statusWorkflow])
  @@index([status])
  @@index([status, publishedAt])
}

model NewsArticleTag {
  articleId   String
  tagId       String
  NewsArticle NewsArticle @relation(fields: [articleId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  NewsTag     NewsTag     @relation(fields: [tagId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([articleId, tagId])
  @@index([articleId])
  @@index([tagId])
}

model NewsTag {
  id               String             @id @default(dbgenerated("(gen_random_uuid())::text"))
  associationId    String
  name             String
  slug             String
  color            String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @default(now())
  ArticleGoogleTag ArticleGoogleTag[]
  NewsArticleTag   NewsArticleTag[]

  @@unique([associationId, slug])
  @@index([associationId])
}
